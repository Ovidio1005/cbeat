#include "noise.h"
#include "macros.h"
#include "utils.h"

#define LONG_NOISE_DATA_LENGTH 1024
#define SHORT_NOISE_DATA_LENGTH 256

#define USE_LONG_NOISE_DATA

#ifdef USE_LONG_NOISE_DATA
#define NOISE_DATA_LENGTH LONG_NOISE_DATA_LENGTH
static const uint8_t noise_data[NOISE_DATA_LENGTH] = {
     64, 120, 186, 111, 111, 108, 122, 121, 184, 231, 206, 172, 210,   1, 125, 130, 148, 179,   6,  96, 113, 170, 135, 211,  26, 186,  32,  17, 163, 123,  24,  27, 142,  34, 184, 172,  50,  79, 186, 145, 208,  60, 186, 190, 159, 200, 226, 227, 164, 121,  66, 230, 211, 176,  87, 213, 203, 102,  69, 120,  18, 241, 102,  88, 
      7, 241, 229, 152,  50,  31,  65,  84, 203, 176, 241,  85, 146, 226,  35, 224, 116, 224,  81, 148, 107,  67, 240, 185, 117, 139,  95,  29, 118,   1, 243, 221,  99, 157, 124, 145, 188, 228, 197,  38, 212, 181, 168, 251, 203,  91, 224, 116,  54, 232, 127, 192, 249, 151, 127,  86, 228,  22, 225, 138,  45, 171,  32,  26, 
     36, 150, 181, 203, 247, 228,  95, 147, 234, 219, 134,  55, 137,  97,  66, 238, 202, 117, 131,   2,  16, 148, 130, 240, 242, 245, 101, 129,   7, 217, 115,  33, 175, 151,  64, 224,  64, 126, 239, 152,  72, 128, 183,  60, 161, 103, 194,  17,  78,  25,  87, 212,  17, 185, 216,  27, 217,  10, 206,  80,  72,  40, 204, 125, 
     54,  35,  28, 115,  21,  70, 137, 214, 194, 243, 171, 236, 177, 250, 217, 151,  70, 124, 207,  71,  53, 225, 146,  79, 215, 102, 188, 199, 231, 252,  27,  81,  25, 126,  79, 183, 107, 201,   5, 106, 201, 116, 195,  55, 222, 120,  60, 151, 196,  19, 224,   6,  88, 155, 139, 202,  84, 105, 184,  14, 234, 179, 255, 219, 
    227, 176,  92, 106, 115, 143, 186, 246, 211, 230, 160, 102, 129,   9,  47, 170, 126, 249, 217, 236,  30, 111, 113, 207,  15, 156, 223, 156, 123, 110, 125,  46,  57, 170, 153, 244, 182, 161,  11, 126, 153, 216, 122,   9, 139, 145, 136,  70,   5, 131, 255, 117, 155,  88, 201, 251, 120,  31, 233, 240, 167,  99,  78,  10, 
     85,  74,  57, 241, 136,  66,  93,  44, 248, 102, 199, 139,   4,  49, 213, 151,  17, 173, 197,  71, 169, 114, 109, 126, 121, 103, 132, 134,  16,  81, 225,  21, 195, 228, 187, 253, 170, 100, 240, 237,  28,  57, 147, 191,  22, 210, 164, 214, 247, 151, 101, 105,  36, 195, 223, 224, 209, 176, 245,  40, 242,  89, 166, 233, 
     87,  46,  59, 161, 246,  75,  27, 142, 238, 150, 239,  51, 133,  34, 161,  55,  98, 191, 211,  15, 140, 164, 188, 243, 212, 138, 123, 160, 144,  68, 231, 106, 240, 159,  92, 211, 118,  22,  67, 124,  58, 251,  16, 121, 151, 129,  54, 113,  68, 140,  91, 151, 243, 219, 193,  56,  53,  34,   8,  78,  71,  23,  19,  25, 
    133, 235, 147, 233, 118, 136,  38, 250,  74, 201,  63,  38,  57, 140,  72, 158, 221,  74, 101,  38, 192, 201, 159, 141, 243,  33, 205, 246, 240,  34, 198, 245,  36, 198, 190, 215,  23,  97, 190,  23,  48, 104,  15,   1, 137,  10, 118, 158,  34, 195,  91, 164, 130, 128,  12, 147,  24,  65, 156, 151,  56, 225, 117, 135, 
    198, 116,  57,  94, 253,  30, 131, 166, 151, 147, 129,   9, 211,  67,  47, 243,  52, 191, 137,  71,  98, 183, 181,  45,  89, 237,   6, 173, 151,  23, 194, 209, 204, 172,  48, 125, 120, 133, 233, 141, 223, 117, 157, 117, 138, 191,  23,  25,  35, 252,  64, 173,  76,  75,  67, 147, 106, 122, 179, 243, 234,  26, 119,  40, 
     13, 219, 215, 206,  96,  77,  34,  76, 199,   7, 158,  61, 183, 193, 141,  95,   5, 164, 169,  89, 192, 213,  58, 222, 243,  15, 144, 200, 119,   0, 144, 240,  25, 196, 182, 182,   1, 154,   9, 204, 211,   2, 157, 112, 252, 231, 121, 138,  48,  46,  25,  77, 246, 108,  13,  50, 237, 128,  68,  79, 137, 177, 235, 119, 
    163,  34, 149,  60,  39,  86,  63, 223,  87,  81,  38, 175, 151, 218,  12,  73, 167,  78, 127,  61,  12, 157, 212, 143, 152, 113, 117, 195, 197, 253,  68,  61,   7, 140, 123,  33, 142, 236,  56, 139,  35,  67,  18, 220, 154, 255,  82,  98, 160, 163, 181, 166, 142, 101, 191, 196,  48, 190, 220, 214,  70, 255, 251,  75, 
    147, 237,  13,  35, 135,  90, 173, 150, 215, 145,  62, 196, 233, 155, 252, 255, 179,  26, 131, 247,  95, 239,  13, 198,  79,  79,   9, 192,  19, 106,   0, 209, 127,  80, 251, 117, 227, 145,  57, 118, 152, 176, 180, 209, 246, 151, 156, 127, 201, 201, 213,  57, 156,  13, 147, 145,  72,  75, 244, 126, 200, 239, 161,  50, 
    245,  26, 174, 218, 208, 216, 252,  45, 205,  90, 143,  88,  40,  88, 150, 170,  36, 126,  73, 114, 148, 175, 217,  14, 218, 152,  20,  96, 255, 181, 189, 115, 193, 200, 195, 124, 193, 191, 195, 240,  82, 101,  61, 232,  65,  46, 159, 232, 170, 173, 228, 100,  13, 231,  98,  26,  76, 136, 204, 191, 166, 112, 208, 109, 
    119, 155,  18,  64,  13,  23, 230, 233,  48, 195,  72, 225, 204,  53,  33,  21, 115, 110,  35, 255, 111,  63,  95, 241,  65, 150, 139,  57, 101,  16, 147,  32,  81,  31, 116,  49, 128, 242, 210, 104, 218,  19,  18,  56, 107, 204, 150, 228, 137,  28, 157,  29, 230, 186, 209,  49, 173, 146, 139,  91,  59,  70,   0, 145, 
    166, 188,  79,  27,  64, 135, 210,   8,  17,  93, 128,  81,  80,  76,  19, 161,  49, 187, 109, 199, 237,  82, 195, 217, 122, 238, 177, 227,  63, 216,  12, 222, 171,  29, 124, 134,  71, 172,  59, 243,  57, 190, 243, 110,  69, 215,  52,  71, 152,  79, 223,  36, 248, 148, 253, 213, 159, 118,  61, 178,   1,  51, 234,  83, 
    225, 244,  66, 135, 127,  45, 164,  63,  26, 206, 186,  64,  86,  25,  38,  49,  68, 186, 255,  34, 223, 113, 118,   3, 117, 166,  38, 203, 235,   5,  39, 101, 159,  56,  41, 253, 240,  15, 182, 222,  25, 179,  19,  48, 177, 163, 159,  39, 250, 165, 156, 181, 230, 164, 112, 252, 209, 228, 155, 122,  67, 115,  58,  15
};
#elif defined(USE_SHORT_NOISE_DATA)
#define NOISE_DATA_LENGTH SHORT_NOISE_DATA_LENGTH
static const uint8_t noise_data[NOISE_DATA_LENGTH] = {
     64, 120, 186, 111, 111, 108, 122, 121, 184, 231, 206, 172, 210,   1, 125, 130, 148, 179,   6,  96, 113, 170, 135, 211,  26, 186,  32,  17, 163, 123,  24,  27, 142,  34, 184, 172,  50,  79, 186, 145, 208,  60, 186, 190, 159, 200, 226, 227, 164, 121,  66, 230, 211, 176,  87, 213, 203, 102,  69, 120,  18, 241, 102,  88, 
      7, 241, 229, 152,  50,  31,  65,  84, 203, 176, 241,  85, 146, 226,  35, 224, 116, 224,  81, 148, 107,  67, 240, 185, 117, 139,  95,  29, 118,   1, 243, 221,  99, 157, 124, 145, 188, 228, 197,  38, 212, 181, 168, 251, 203,  91, 224, 116,  54, 232, 127, 192, 249, 151, 127,  86, 228,  22, 225, 138,  45, 171,  32,  26, 
     36, 150, 181, 203, 247, 228,  95, 147, 234, 219, 134,  55, 137,  97,  66, 238, 202, 117, 131,   2,  16, 148, 130, 240, 242, 245, 101, 129,   7, 217, 115,  33, 175, 151,  64, 224,  64, 126, 239, 152,  72, 128, 183,  60, 161, 103, 194,  17,  78,  25,  87, 212,  17, 185, 216,  27, 217,  10, 206,  80,  72,  40, 204, 125, 
     54,  35,  28, 115,  21,  70, 137, 214, 194, 243, 171, 236, 177, 250, 217, 151,  70, 124, 207,  71,  53, 225, 146,  79, 215, 102, 188, 199, 231, 252,  27,  81,  25, 126,  79, 183, 107, 201,   5, 106, 201, 116, 195,  55, 222, 120,  60, 151, 196,  19, 224,   6,  88, 155, 139, 202,  84, 105, 184,  14, 234, 179, 255, 219
};
#else
#error "Either USE_LONG_NOISE_DATA or USE_SHORT_NOISE_DATA must be defined for noise.c"
#endif


static uint16_t current_sample = 0;

static uint8_t amplitude = 255;

uint8_t noise_amplitude(void) {
    return amplitude;
}

void noise_set_amplitude(uint8_t amp) {
    amplitude = amp;
}

uint8_t noise_step(void) {
    uint8_t output = apply_amplitude(noise_data[current_sample], amplitude);
    current_sample = (current_sample + 1) % NOISE_DATA_LENGTH;

    return output;
}